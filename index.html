<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>bible of ithar</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden;
    user-select: none;
    background: #000;
  }
  #container {
    width: 100%;
    height: 100%;
    overflow: auto;
    background: #000;
    cursor: grab;
    touch-action: pan-x pan-y;
    position: relative;
  }
  #image-wrapper {
    position: relative;
    display: inline-block;
  }
  #image {
    display: block;
    transform-origin: 0 0;
    max-width: none;
    user-select: none;
  }
  .video {
    position: absolute;
    width: 600px;
    height: 400px;
    object-fit: cover;
    pointer-events: none;
    opacity: 0.75; /* کمی کدرتر */
  }
</style>
</head>
<body>
<div id="container">
  <div id="image-wrapper">
    <img id="image" src="bible.jpg" alt="تصویر">
  </div>
</div>

<script>
// ---------- کد زوم و درگ تصویر ----------
const container = document.getElementById('container');
const imageWrapper = document.getElementById('image-wrapper');
const img = document.getElementById('image');
let scale = 1;
let lastDistance = null;
const MIN_SCALE = 0.5;
const MAX_SCALE = 3;

function getDistance(touches) {
  const dx = touches[0].clientX - touches[1].clientX;
  const dy = touches[0].clientY - touches[1].clientY;
  return Math.hypot(dx, dy);
}

function getMidPoint(touches) {
  return {
    x: (touches[0].clientX + touches[1].clientX) / 2,
    y: (touches[0].clientY + touches[1].clientY) / 2
  };
}

img.addEventListener('touchmove', (e) => {
  if(e.touches.length === 2){
    e.preventDefault();
    const distance = getDistance(e.touches);
    const mid = getMidPoint(e.touches);

    const rect = imageWrapper.getBoundingClientRect();
    const offsetX = mid.x - rect.left;
    const offsetY = mid.y - rect.top;

    const originX = (offsetX / rect.width) * 100;
    const originY = (offsetY / rect.height) * 100;
    imageWrapper.style.transformOrigin = `${originX}% ${originY}%`;

    if(lastDistance){
      const delta = distance / lastDistance;
      scale *= delta;
      if(scale < MIN_SCALE) scale = MIN_SCALE;
      if(scale > MAX_SCALE) scale = MAX_SCALE;
      imageWrapper.style.transform = `scale(${scale})`;
    }
    lastDistance = distance;
  }
});

img.addEventListener('touchend', (e) => {
  if(e.touches.length < 2) lastDistance = null;
});

container.addEventListener('wheel', (e) => {
  if(e.ctrlKey){
    e.preventDefault();
    const rect = imageWrapper.getBoundingClientRect();
    const offsetX = e.clientX - rect.left;
    const offsetY = e.clientY - rect.top;
    const originX = (offsetX / rect.width) * 100;
    const originY = (offsetY / rect.height) * 100;
    imageWrapper.style.transformOrigin = `${originX}% ${originY}%`;

    scale *= e.deltaY < 0 ? 1.1 : 0.9;
    if(scale < MIN_SCALE) scale = MIN_SCALE;
    if(scale > MAX_SCALE) scale = MAX_SCALE;
    imageWrapper.style.transform = `scale(${scale})`;
  }
});

// ---------- Drag تصویر ----------
let isDragging = false;
let startX, startY, scrollLeft, scrollTop;

container.addEventListener('mousedown', (e) => {
  isDragging = true;
  startX = e.pageX - container.offsetLeft;
  startY = e.pageY - container.offsetTop;
  scrollLeft = container.scrollLeft;
  scrollTop = container.scrollTop;
  container.style.cursor = 'grabbing';
});

container.addEventListener('mouseup', () => {
  isDragging = false;
  container.style.cursor = 'grab';
});

container.addEventListener('mouseleave', () => {
  isDragging = false;
  container.style.cursor = 'grab';
});

container.addEventListener('mousemove', (e) => {
  if(!isDragging) return;
  e.preventDefault();
  const x = e.pageX - container.offsetLeft;
  const y = e.pageY - container.offsetTop;
  container.scrollLeft = scrollLeft - (x - startX);
  container.scrollTop = scrollTop - (y - startY);
});

// ---------- اضافه کردن ویدیوها روی تصویر ----------
const videos = ['video1.mp4', 'video2.mp4', 'video3.mp4'];
const repeatCount = 6;

function getRandomPosition(videoWidth, videoHeight) {
  const x = Math.random() * (imageWrapper.offsetWidth - videoWidth);
  const y = Math.random() * (imageWrapper.offsetHeight - videoHeight);
  return {x, y};
}

img.onload = () => {
  videos.forEach(src => {
    for(let i=0;i<repeatCount;i++){
      const vid = document.createElement('video');
      vid.src = src;
      vid.autoplay = true;
      vid.loop = true;
      vid.muted = true;
      vid.className = 'video';

      const pos = getRandomPosition(600, 400);
      vid.style.left = pos.x + 'px';
      vid.style.top = pos.y + 'px';

      imageWrapper.appendChild(vid);
    }
  });
}
</script>
</body>
</html>
